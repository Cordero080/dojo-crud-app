<!-- views/forms/index2.ejs -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/head') %>
  </head>
  <body class="page-index-2">
    <%- include('../partials/nav') %>
    <!-- If your nav already includes the back arrow, you can delete the next line -->
   

    <h1><%= title %></h1>

    <%
      function cap(s){ s = String(s || ''); return s ? s[0].toUpperCase() + s.slice(1) : '-'; }
      function catLabel(c){ return c === 'Kumite' ? 'Kiso Kumite' : c; }
      function safeDate(d){
        try { return d ? new Date(d).toLocaleDateString() : '-'; }
        catch(_){ return '-'; }
      }
    %>

    <% if (!forms || forms.length === 0) { %>
      <p>No forms yet. Create one to get started.</p>
    <% } else { %>
      <table class="forms-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Rank</th>
            <th>Belt</th>
            <th>Category</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% forms.forEach(f => { %>
            <tr class="<%= f.learned ? 'is-learned' : '' %>">
              <td><a href="/forms/<%= f._id %>"><%= f.name %></a></td>
              <td><%= String(f.rankType).toUpperCase() %> <%= Number(f.rankNumber) %></td>
              <td><%= cap(f.beltColor) %></td>
              <td><%= catLabel(f.category) %></td>
              <td><%= safeDate(f.createdAt) %></td>
              <td>
                <a href="/forms/<%= f._id %>">Show</a> |
                <a href="/forms/<%= f._id %>/edit">Edit</a> |
                <a href="#" class="delete-link" data-id="<%= f._id %>">Delete</a>
                <form id="del-<%= f._id %>" action="/forms/<%= f._id %>?_method=DELETE" method="POST" style="display:none"></form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>

    <%- include('../partials/footer') %>

    <!-- Delete confirm overlay (wired by /js/main.js) -->
    <div id="delete-overlay" class="delete-overlay" style="display:none">
      <div class="delete-dialog">
        <div class="delete-dialog-title">Are you sure you want to delete this form?</div>
        <button id="confirm-delete-btn" class="delete-btn">Delete</button>
        <button id="cancel-delete-btn" class="cancel-btn">Cancel</button>
      </div>
    </div>
  </body>
</html>
